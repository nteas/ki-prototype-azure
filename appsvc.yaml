# appsvc.yaml file for Python/React app
# See https://docs.microsoft.com/en-us/azure/app-service/configure-language-python for more information

# Set the version of the appsvc.yaml file
version: 1

# Define the pre-build command to install Node.js and build the React app
pre-build: |
    curl -LO https://nodejs.org/dist/v18.0.0/node-v18.0.0-linux-x64.tar.xz
    mkdir ~/nodejs
    tar -xJf node-v18.0.0-linux-x64.tar.xz -C ~/nodejs --strip-components=1
    export PATH=$HOME/nodejs/bin:$PATH
    node -v
    npm -v
    cd app/frontend
    npm install
    npm run build

# Define the run command to start the Python app and serve the React app
run: |
    cd app/backend
    pip install -r requirements.txt
    python3 -m gunicorn main:app
